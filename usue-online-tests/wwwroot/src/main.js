var Cs=Object.defineProperty;var Os=(e,s,t)=>s in e?Cs(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var E=(e,s,t)=>(Os(e,typeof s!="symbol"?s+"":s,t),t);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerpolicy&&(l.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?l.credentials="include":o.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();function Ye(e,s,t,n=o=>o){return e*n(.5-s*(.5-t))}function Is(e){return[-e[0],-e[1]]}function tt(e,s){return[e[0]+s[0],e[1]+s[1]]}function Z(e,s){return[e[0]-s[0],e[1]-s[1]]}function U(e,s){return[e[0]*s,e[1]*s]}function Ts(e,s){return[e[0]/s,e[1]/s]}function vt(e){return[e[1],-e[0]]}function qe(e,s){return e[0]*s[0]+e[1]*s[1]}function zs(e,s){return e[0]===s[0]&&e[1]===s[1]}function Ws(e){return Math.hypot(e[0],e[1])}function Ns(e){return e[0]*e[0]+e[1]*e[1]}function Re(e,s){return Ns(Z(e,s))}function ls(e){return Ts(e,Ws(e))}function Bs(e,s){return Math.hypot(e[1]-s[1],e[0]-s[0])}function xt(e,s,t){let n=Math.sin(t),o=Math.cos(t),l=e[0]-s[0],i=e[1]-s[1],r=l*o-i*n,a=l*n+i*o;return[r+s[0],a+s[1]]}function fe(e,s,t){return tt(e,U(Z(s,e),t))}function _e(e,s,t){return tt(e,U(s,t))}var{min:pt,PI:js}=Math,Ke=.275,Pt=js+1e-4;function Ds(e,s={}){let{size:t=16,smoothing:n=.5,thinning:o=.5,simulatePressure:l=!0,easing:i=L=>L,start:r={},end:a={},last:h=!1}=s,{cap:c=!0,easing:f=L=>L*(2-L)}=r,{cap:p=!0,easing:u=L=>--L*L*L+1}=a;if(e.length===0||t<=0)return[];let d=e[e.length-1].runningLength,g=r.taper===!1?0:r.taper===!0?Math.max(t,d):r.taper,y=a.taper===!1?0:a.taper===!0?Math.max(t,d):a.taper,k=Math.pow(t*n,2),v=[],S=[],N=e.slice(0,10).reduce((L,$)=>{let I=$.pressure;if(l){let W=pt(1,$.distance/t),re=pt(1,1-W);I=pt(1,L+(re-L)*(W*Ke))}return(L+I)/2},e[0].pressure),x=Ye(t,o,e[e.length-1].pressure,i),C,D=e[0].vector,F=e[0].point,H=F,B=F,A=H,rt=!1;for(let L=0;L<e.length;L++){let{pressure:$}=e[L],{point:I,vector:W,distance:re,runningLength:Mt}=e[L];if(L<e.length-1&&d-Mt<3)continue;if(o){if(l){let lt=pt(1,re/t),ae=pt(1,1-lt);$=pt(1,N+(ae-N)*(lt*Ke))}x=Ye(t,o,$,i)}else x=t/2;C===void 0&&(C=x);let Es=Mt<g?f(Mt/g):1,Ls=d-Mt<y?u((d-Mt)/y):1;x=Math.max(.01,x*Math.min(Es,Ls));let Fe=(L<e.length-1?e[L+1]:e[L]).vector,le=L<e.length-1?qe(W,Fe):1,Ss=qe(W,D)<0&&!rt,$e=le!==null&&le<0;if(Ss||$e){let lt=U(vt(D),x);for(let ae=1/13,Dt=0;Dt<=1;Dt+=ae)B=xt(Z(I,lt),I,Pt*Dt),v.push(B),A=xt(tt(I,lt),I,Pt*-Dt),S.push(A);F=B,H=A,$e&&(rt=!0);continue}if(rt=!1,L===e.length-1){let lt=U(vt(W),x);v.push(Z(I,lt)),S.push(tt(I,lt));continue}let Xe=U(vt(fe(Fe,W,le)),x);B=Z(I,Xe),(L<=1||Re(F,B)>k)&&(v.push(B),F=B),A=tt(I,Xe),(L<=1||Re(H,A)>k)&&(S.push(A),H=A),N=$,D=W}let T=e[0].point.slice(0,2),O=e.length>1?e[e.length-1].point.slice(0,2):tt(e[0].point,[1,1]),_=[],Q=[];if(e.length===1){if(!(g||y)||h){let L=_e(T,ls(vt(Z(T,O))),-(C||x)),$=[];for(let I=1/13,W=I;W<=1;W+=I)$.push(xt(L,T,Pt*2*W));return $}}else{if(!(g||y&&e.length===1))if(c)for(let $=1/13,I=$;I<=1;I+=$){let W=xt(S[0],T,Pt*I);_.push(W)}else{let $=Z(v[0],S[0]),I=U($,.5),W=U($,.51);_.push(Z(T,I),Z(T,W),tt(T,W),tt(T,I))}let L=vt(Is(e[e.length-1].vector));if(y||g&&e.length===1)Q.push(O);else if(p){let $=_e(O,L,x);for(let I=1/29,W=I;W<1;W+=I)Q.push(xt($,O,Pt*3*W))}else Q.push(tt(O,U(L,x)),tt(O,U(L,x*.99)),Z(O,U(L,x*.99)),Z(O,U(L,x)))}return v.concat(Q,S.reverse(),_)}function As(e,s={}){var t;let{streamline:n=.5,size:o=16,last:l=!1}=s;if(e.length===0)return[];let i=.15+(1-n)*.85,r=Array.isArray(e[0])?e:e.map(({x:u,y:d,pressure:g=.5})=>[u,d,g]);if(r.length===2){let u=r[1];r=r.slice(0,-1);for(let d=1;d<5;d++)r.push(fe(r[0],u,d/4))}r.length===1&&(r=[...r,[...tt(r[0],[1,1]),...r[0].slice(2)]]);let a=[{point:[r[0][0],r[0][1]],pressure:r[0][2]>=0?r[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],h=!1,c=0,f=a[0],p=r.length-1;for(let u=1;u<r.length;u++){let d=l&&u===p?r[u].slice(0,2):fe(f.point,r[u],i);if(zs(f.point,d))continue;let g=Bs(d,f.point);if(c+=g,u<p&&!h){if(c<o)continue;h=!0}f={point:d,pressure:r[u][2]>=0?r[u][2]:.5,vector:ls(Z(f.point,d)),distance:g,runningLength:c},a.push(f)}return a[0].vector=((t=a[1])==null?void 0:t.vector)||[0,0],a}function Fs(e,s={}){return Ds(As(e,s),s)}var $s=Fs;function Xs(e,s,t){let n=JSON.parse(e);switch(n.typeName){case"rectangle":let{color:l,width:i,startPoint:r,endPoint:a,fillStyle:h,stroke:c,strokeWidth:f,userId:p,zoom:u,objId:d}=n,g=new Ce(l,i,r,a,h,s,c,f,p);return g.objId=d,g.zoom=u,g;case"ellipse":{let{color:y,width:k,startPoint:v,endPoint:S,fillStyle:N,stroke:x,strokeWidth:C,isCircle:D,userId:F,zoom:H,objId:B}=n,A=new Oe(y,k,v,S,N,s,x,C,D,F);return A.objId=B,A.zoom=H,A}case"line":{let{color:y,width:k,startPoint:v,endPoint:S,userId:N,zoom:x,objId:C}=n,D=new Ot(y,k,v,S,s,N);return D.zoom=x,D.objId=C,D}case"curve":{let{pointsList:y,color:k,width:v,userId:S,zoom:N,objId:x}=n,C=new Se(y,k,v,t,S);return C.objId=x,C.zoom=N,C}case"text":{let{color:y,width:k,userId:v,zoom:S,objId:N,left:x,top:C,fontFamily:D,text:F,inputId:H,fontSize:B,textColor:A,height:rt}=n,T=new cs(D,y,v,null,C,x,F,H,B,A,k,rt);return T.objId=N,T.zoom=S,T}default:return null}}function Ys(e,s,t){const n={transform:`translate(${e}px, ${s}px)`};t.animate(n,{fill:"forwards"})}function qs(e,s,t,n){s.fillStyle=as(e,n),t.style.backgroundColor=e}function At(e,s){return(e+s)/2}function Rs(e,s=!0){const t=e.length;if(t<4)return"";let n=e[0],o=e[1];const l=e[2];let i=`M${n[0].toFixed(2)},${n[1].toFixed(2)} Q${o[0].toFixed(2)},${o[1].toFixed(2)} ${At(o[0],l[0]).toFixed(2)},${At(o[1],l[1]).toFixed(2)} T`;for(let r=2,a=t-1;r<a;r++)n=e[r],o=e[r+1],i+=`${At(n[0],o[0]).toFixed(2)},${At(n[1],o[1]).toFixed(2)} `;return s&&(i+="Z"),i}function ne(e,s="1"){let t,n;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return t=e.substring(1).split(""),t.length==3&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]]),n=+("0x"+t.join("")),"rgba("+[n>>16&255,n>>8&255,n&255].join(",")+","+s+")";throw new Error("Bad Hex")}function as(e,s){let t=e.slice(e.indexOf("(")+1,e.indexOf(")")).split(", ");return"rgba("+t[0]+", "+t[1]+", "+t[2]+", "+s+")"}function Le(e){let s="";const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",n=t.length;for(let o=0;o<e;o++)s+=t.charAt(Math.floor(Math.random()*n));return s}function _s(e){e.clearRect(0,0,document.documentElement.clientWidth,document.documentElement.clientHeight)}function Ks(e,s,t,n,o){for(let l=0;l<e.length;l++){const i=e[l];i.isOverlay(s,t,n,o)&&i.draw(s,t)}}class Bt{constructor(s,t,n){E(this,"color");E(this,"width");E(this,"userId");E(this,"typeName","");E(this,"tempObj",!1);E(this,"zoom",1);E(this,"objId",Le(6));this.color=s,this.width=t,this.userId=n}draw(s,t){console.log("offset:",s,t)}isOverlay(s,t,n,o){return!0}}class cs extends Bt{constructor(t,n,o,l,i,r,a,h,c,f,p,u){super(n,p,o);E(this,"typeName","text");E(this,"inputElement");E(this,"top");E(this,"left");E(this,"fontFamily");E(this,"text");E(this,"inputId");E(this,"fontSize");E(this,"textColor");E(this,"height");this.userId=o,this.top=i,this.left=r,this.fontFamily=t,this.text=a,this.inputId=h,this.inputElement=l!=null?l:null,this.fontSize=c,this.textColor=f,this.height=u,l!==null&&(l.value=a)}draw(t,n){this.inputElement!==null&&(this.inputElement.style.left=this.left*this.zoom+t+"px",this.inputElement.style.top=this.top*this.zoom+n+"px",this.inputElement.style.fontSize=`${this.zoom*32}px`,this.inputElement.style.width=`${this.width*this.zoom}px`,this.inputElement.style.height=`${this.height*this.zoom}px`)}isOverlay(t,n,o,l){return!0}}class Se extends Bt{constructor(t,n,o,l,i){super(n,o,i);E(this,"pointsList");E(this,"ctx");E(this,"typeName","curve");this.pointsList=t,this.ctx=l,this.userId=i}draw(t,n){let o=[];for(let h=0;h<this.pointsList.length;h++){let c=this.pointsList[h];o.push([c[0]*this.zoom+t,c[1]*this.zoom+n])}const l=$s(o,{size:this.width*this.zoom,thinning:.5,smoothing:.2,easing:h=>h*.8,simulatePressure:!0}),i=Rs(l),r=new Path2D(i);let a=this.ctx.fillStyle;this.ctx.fillStyle=this.color.startsWith("#")?ne(this.color):this.color,this.ctx.fill(r),this.ctx.fillStyle=a}isCloseToPoints(t,n,o){if(this.pointsList.length===0)return!1;for(let l=0;l<this.pointsList.length;l++){const i=this.pointsList[l];if(Math.sqrt(Math.pow(t-i[0],2)+Math.pow(n-i[1],2))<o)return!0}return!1}isOverlay(t,n,o,l){if(t*=-1,n*=-1,this.pointsList.length===0)return!1;let i=this.pointsList[0][0],r=this.pointsList[0][0],a=this.pointsList[0][1],h=this.pointsList[0][1];for(let d=0;d<this.pointsList.length;d++){const g=this.pointsList[d];i=i>g[0]?g[0]:i,r=r<g[0]?g[0]:r,a=a>g[1]?g[1]:a,h=h<g[1]?g[1]:h}i*=this.zoom,a*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,f=n,p=t+o,u=n+l;return(i>=c&&i<=p||r>=c&&r<=p)&&(a>=f&&a<=u||h>=f&&h<=u)||(c>=i&&c<=r||p>=i&&p<=r)&&(f>=a&&f<=h||u>=a&&u<=h)||(i>=c&&i<=p||r>=c&&r<=p)&&(f>=a&&f<=h||u>=a&&u<=h)||(c>=i&&c<=r||p>=i&&p<=r)&&(a>=f&&a<=u||h>=f&&h<=u)}}class Ot extends Bt{constructor(t,n,o,l,i,r){super(t,n,r);E(this,"startPoint");E(this,"endPoint");E(this,"roughCanvas");E(this,"typeName","line");this.startPoint=o,this.endPoint=l,this.roughCanvas=i,this.userId=r}draw(t,n){this.roughCanvas.line(this.startPoint[0]*this.zoom+t,this.startPoint[1]*this.zoom+n,this.endPoint[0]*this.zoom+t,this.endPoint[1]*this.zoom+n,{strokeWidth:this.width*this.zoom,stroke:this.color,seed:1})}isOverlay(t,n,o,l){t*=-1,n*=-1;let i=Math.min(this.startPoint[0],this.endPoint[0]),r=Math.max(this.startPoint[0],this.endPoint[0]),a=Math.min(this.startPoint[1],this.endPoint[1]),h=Math.max(this.startPoint[1],this.endPoint[1]);i*=this.zoom,a*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,f=n,p=t+o,u=n+l;return(i>=c&&i<=p||r>=c&&r<=p)&&(a>=f&&a<=u||h>=f&&h<=u)||(c>=i&&c<=r||p>=i&&p<=r)&&(f>=a&&f<=h||u>=a&&u<=h)||(i>=c&&i<=p||r>=c&&r<=p)&&(f>=a&&f<=h||u>=a&&u<=h)||(c>=i&&c<=r||p>=i&&p<=r)&&(a>=f&&a<=u||h>=f&&h<=u)}isCloseToPoints(t,n,o){return Math.sqrt(Math.pow(t-this.startPoint[0],2)+Math.pow(n-this.startPoint[1],2))<o||Math.sqrt(Math.pow(t-this.endPoint[0],2)+Math.pow(n-this.endPoint[1],2))<o}}class Ce extends Bt{constructor(t,n,o,l,i,r,a,h,c){super(t,n,c);E(this,"startPoint");E(this,"endPoint");E(this,"roughCanvas");E(this,"fillStyle");E(this,"typeName","rectangle");E(this,"stroke");E(this,"strokeWidth");E(this,"drawableObj",null);this.startPoint=o,this.endPoint=l,this.roughCanvas=r,this.fillStyle=i,this.stroke=a,this.strokeWidth=h,this.userId=c}draw(t,n){let o=(this.endPoint[0]-this.startPoint[0])*this.zoom,l=(this.endPoint[1]-this.startPoint[1])*this.zoom;this.roughCanvas.rectangle(this.startPoint[0]*this.zoom+t,this.startPoint[1]*this.zoom+n,o,l,{strokeWidth:this.width*this.zoom,fill:this.color,fillStyle:this.fillStyle,seed:1,stroke:this.stroke})}isOverlay(t,n,o,l){t*=-1,n*=-1;let i=Math.min(this.startPoint[0],this.endPoint[0]),r=Math.max(this.startPoint[0],this.endPoint[0]),a=Math.min(this.startPoint[1],this.endPoint[1]),h=Math.max(this.startPoint[1],this.endPoint[1]);i*=this.zoom,a*=this.zoom,r*=this.zoom,h*=this.zoom;let c=t,f=n,p=t+o,u=n+l;return(i>=c&&i<=p||r>=c&&r<=p)&&(a>=f&&a<=u||h>=f&&h<=u)||(c>=i&&c<=r||p>=i&&p<=r)&&(f>=a&&f<=h||u>=a&&u<=h)||(i>=c&&i<=p||r>=c&&r<=p)&&(f>=a&&f<=h||u>=a&&u<=h)||(c>=i&&c<=r||p>=i&&p<=r)&&(a>=f&&a<=u||h>=f&&h<=u)}}class Oe extends Bt{constructor(t,n,o,l,i,r,a,h,c,f){super(t,n,f);E(this,"startPoint");E(this,"endPoint");E(this,"roughCanvas");E(this,"fillStyle");E(this,"typeName","ellipse");E(this,"stroke");E(this,"strokeWidth");E(this,"drawableObj",null);E(this,"isCircle");this.startPoint=o,this.endPoint=l,this.roughCanvas=r,this.fillStyle=i,this.stroke=a,this.strokeWidth=h,this.isCircle=c,this.userId=this.userId}draw(t,n){let o=(this.endPoint[0]-this.startPoint[0])*this.zoom,l=(this.endPoint[1]-this.startPoint[1])*this.zoom;this.roughCanvas.ellipse(this.startPoint[0]*this.zoom+t,this.startPoint[1]*this.zoom+n,o*2,l*2,{strokeWidth:this.width*this.zoom,fill:this.color,fillStyle:this.fillStyle,seed:1,stroke:this.stroke})}isOverlay(t,n,o,l){t*=-1,n*=-1;let i=Math.min(this.startPoint[0],this.endPoint[0]),r=Math.max(this.startPoint[0],this.endPoint[0]),a=Math.min(this.startPoint[1],this.endPoint[1]),h=Math.max(this.startPoint[1],this.endPoint[1]);i*=this.zoom,a*=this.zoom,r*=this.zoom,h*=this.zoom,this.startPoint[0]<this.endPoint[0]?i+=i-r:r-=i-r,this.startPoint[1]<this.endPoint[1]?a+=a-h:h-=a-h;let c=t,f=n,p=t+o,u=n+l;return(i>=c&&i<=p||r>=c&&r<=p)&&(a>=f&&a<=u||h>=f&&h<=u)||(c>=i&&c<=r||p>=i&&p<=r)&&(f>=a&&f<=h||u>=a&&u<=h)||(i>=c&&i<=p||r>=c&&r<=p)&&(f>=a&&f<=h||u>=a&&u<=h)||(c>=i&&c<=r||p>=i&&p<=r)&&(a>=f&&a<=u||h>=f&&h<=u)}closeToCentre(t,n){return Math.sqrt(Math.pow(t-this.startPoint[0],2)+Math.pow(n-this.startPoint[1],2))<Math.max(Math.min(Math.abs(Math.abs(this.startPoint[0])-Math.abs(this.endPoint[0])),Math.abs(Math.abs(this.startPoint[1])-Math.abs(this.endPoint[1]))),10)}}function ce(e,s,t){if(e&&e.length){const[n,o]=s,l=Math.PI/180*t,i=Math.cos(l),r=Math.sin(l);e.forEach(a=>{const[h,c]=a;a[0]=(h-n)*i-(c-o)*r+n,a[1]=(h-n)*r+(c-o)*i+o})}}function oe(e){const s=e[0],t=e[1];return Math.sqrt(Math.pow(s[0]-t[0],2)+Math.pow(s[1]-t[1],2))}function jt(e,s){const t=s.hachureAngle+90;let n=s.hachureGap;n<0&&(n=4*s.strokeWidth),n=Math.max(n,.1);const o=[0,0];if(t)for(const i of e)ce(i,o,t);const l=function(i,r){const a=[];for(const u of i){const d=[...u];d[0].join(",")!==d[d.length-1].join(",")&&d.push([d[0][0],d[0][1]]),d.length>2&&a.push(d)}const h=[];r=Math.max(r,.1);const c=[];for(const u of a)for(let d=0;d<u.length-1;d++){const g=u[d],y=u[d+1];if(g[1]!==y[1]){const k=Math.min(g[1],y[1]);c.push({ymin:k,ymax:Math.max(g[1],y[1]),x:k===g[1]?g[0]:y[0],islope:(y[0]-g[0])/(y[1]-g[1])})}}if(c.sort((u,d)=>u.ymin<d.ymin?-1:u.ymin>d.ymin?1:u.x<d.x?-1:u.x>d.x?1:u.ymax===d.ymax?0:(u.ymax-d.ymax)/Math.abs(u.ymax-d.ymax)),!c.length)return h;let f=[],p=c[0].ymin;for(;f.length||c.length;){if(c.length){let u=-1;for(let d=0;d<c.length&&!(c[d].ymin>p);d++)u=d;c.splice(0,u+1).forEach(d=>{f.push({s:p,edge:d})})}if(f=f.filter(u=>!(u.edge.ymax<=p)),f.sort((u,d)=>u.edge.x===d.edge.x?0:(u.edge.x-d.edge.x)/Math.abs(u.edge.x-d.edge.x)),f.length>1)for(let u=0;u<f.length;u+=2){const d=u+1;if(d>=f.length)break;const g=f[u].edge,y=f[d].edge;h.push([[Math.round(g.x),p],[Math.round(y.x),p]])}p+=r,f.forEach(u=>{u.edge.x=u.edge.x+r*u.edge.islope})}return h}(e,n);if(t){for(const i of e)ce(i,o,-t);(function(i,r,a){const h=[];i.forEach(c=>h.push(...c)),ce(h,r,a)})(l,o,-t)}return l}class Ie{constructor(s){this.helper=s}fillPolygons(s,t){return this._fillPolygons(s,t)}_fillPolygons(s,t){const n=jt(s,t);return{type:"fillSketch",ops:this.renderLines(n,t)}}renderLines(s,t){const n=[];for(const o of s)n.push(...this.helper.doubleLineOps(o[0][0],o[0][1],o[1][0],o[1][1],t));return n}}class Hs extends Ie{fillPolygons(s,t){let n=t.hachureGap;n<0&&(n=4*t.strokeWidth),n=Math.max(n,.1);const o=jt(s,Object.assign({},t,{hachureGap:n})),l=Math.PI/180*t.hachureAngle,i=[],r=.5*n*Math.cos(l),a=.5*n*Math.sin(l);for(const[h,c]of o)oe([h,c])&&i.push([[h[0]-r,h[1]+a],[...c]],[[h[0]+r,h[1]-a],[...c]]);return{type:"fillSketch",ops:this.renderLines(i,t)}}}class Vs extends Ie{fillPolygons(s,t){const n=this._fillPolygons(s,t),o=Object.assign({},t,{hachureAngle:t.hachureAngle+90}),l=this._fillPolygons(s,o);return n.ops=n.ops.concat(l.ops),n}}class Gs{constructor(s){this.helper=s}fillPolygons(s,t){const n=jt(s,t=Object.assign({},t,{hachureAngle:0}));return this.dotsOnLines(n,t)}dotsOnLines(s,t){const n=[];let o=t.hachureGap;o<0&&(o=4*t.strokeWidth),o=Math.max(o,.1);let l=t.fillWeight;l<0&&(l=t.strokeWidth/2);const i=o/4;for(const r of s){const a=oe(r),h=a/o,c=Math.ceil(h)-1,f=a-c*o,p=(r[0][0]+r[1][0])/2-o/4,u=Math.min(r[0][1],r[1][1]);for(let d=0;d<c;d++){const g=u+f+d*o,y=p-i+2*Math.random()*i,k=g-i+2*Math.random()*i,v=this.helper.ellipse(y,k,l,l,t);n.push(...v.ops)}}return{type:"fillSketch",ops:n}}}class Zs{constructor(s){this.helper=s}fillPolygons(s,t){const n=jt(s,t);return{type:"fillSketch",ops:this.dashedLine(n,t)}}dashedLine(s,t){const n=t.dashOffset<0?t.hachureGap<0?4*t.strokeWidth:t.hachureGap:t.dashOffset,o=t.dashGap<0?t.hachureGap<0?4*t.strokeWidth:t.hachureGap:t.dashGap,l=[];return s.forEach(i=>{const r=oe(i),a=Math.floor(r/(n+o)),h=(r+o-a*(n+o))/2;let c=i[0],f=i[1];c[0]>f[0]&&(c=i[1],f=i[0]);const p=Math.atan((f[1]-c[1])/(f[0]-c[0]));for(let u=0;u<a;u++){const d=u*(n+o),g=d+n,y=[c[0]+d*Math.cos(p)+h*Math.cos(p),c[1]+d*Math.sin(p)+h*Math.sin(p)],k=[c[0]+g*Math.cos(p)+h*Math.cos(p),c[1]+g*Math.sin(p)+h*Math.sin(p)];l.push(...this.helper.doubleLineOps(y[0],y[1],k[0],k[1],t))}}),l}}class Js{constructor(s){this.helper=s}fillPolygons(s,t){const n=t.hachureGap<0?4*t.strokeWidth:t.hachureGap,o=t.zigzagOffset<0?n:t.zigzagOffset,l=jt(s,t=Object.assign({},t,{hachureGap:n+o}));return{type:"fillSketch",ops:this.zigzagLines(l,o,t)}}zigzagLines(s,t,n){const o=[];return s.forEach(l=>{const i=oe(l),r=Math.round(i/(2*t));let a=l[0],h=l[1];a[0]>h[0]&&(a=l[1],h=l[0]);const c=Math.atan((h[1]-a[1])/(h[0]-a[0]));for(let f=0;f<r;f++){const p=2*f*t,u=2*(f+1)*t,d=Math.sqrt(2*Math.pow(t,2)),g=[a[0]+p*Math.cos(c),a[1]+p*Math.sin(c)],y=[a[0]+u*Math.cos(c),a[1]+u*Math.sin(c)],k=[g[0]+d*Math.cos(c+Math.PI/4),g[1]+d*Math.sin(c+Math.PI/4)];o.push(...this.helper.doubleLineOps(g[0],g[1],k[0],k[1],n),...this.helper.doubleLineOps(k[0],k[1],y[0],y[1],n))}}),o}}const K={};class Qs{constructor(s){this.seed=s}next(){return this.seed?(2**31-1&(this.seed=Math.imul(48271,this.seed)))/2**31:Math.random()}}const Ft={A:7,a:7,C:6,c:6,H:1,h:1,L:2,l:2,M:2,m:2,Q:4,q:4,S:4,s:4,T:2,t:2,V:1,v:1,Z:0,z:0};function he(e,s){return e.type===s}function pe(e){const s=[],t=function(i){const r=new Array;for(;i!=="";)if(i.match(/^([ \t\r\n,]+)/))i=i.substr(RegExp.$1.length);else if(i.match(/^([aAcChHlLmMqQsStTvVzZ])/))r[r.length]={type:0,text:RegExp.$1},i=i.substr(RegExp.$1.length);else{if(!i.match(/^(([-+]?[0-9]+(\.[0-9]*)?|[-+]?\.[0-9]+)([eE][-+]?[0-9]+)?)/))return[];r[r.length]={type:1,text:`${parseFloat(RegExp.$1)}`},i=i.substr(RegExp.$1.length)}return r[r.length]={type:2,text:""},r}(e);let n="BOD",o=0,l=t[o];for(;!he(l,2);){let i=0;const r=[];if(n==="BOD"){if(l.text!=="M"&&l.text!=="m")return pe("M0,0"+e);o++,i=Ft[l.text],n=l.text}else he(l,1)?i=Ft[n]:(o++,i=Ft[l.text],n=l.text);if(!(o+i<t.length))throw new Error("Path data ended short");for(let a=o;a<o+i;a++){const h=t[a];if(!he(h,1))throw new Error("Param not a number: "+n+","+h.text);r[r.length]=+h.text}if(typeof Ft[n]!="number")throw new Error("Bad segment: "+n);{const a={key:n,data:r};s.push(a),o+=i,l=t[o],n==="M"&&(n="L"),n==="m"&&(n="l")}}return s}function He(e){let s=0,t=0,n=0,o=0;const l=[];for(const{key:i,data:r}of e)switch(i){case"M":l.push({key:"M",data:[...r]}),[s,t]=r,[n,o]=r;break;case"m":s+=r[0],t+=r[1],l.push({key:"M",data:[s,t]}),n=s,o=t;break;case"L":l.push({key:"L",data:[...r]}),[s,t]=r;break;case"l":s+=r[0],t+=r[1],l.push({key:"L",data:[s,t]});break;case"C":l.push({key:"C",data:[...r]}),s=r[4],t=r[5];break;case"c":{const a=r.map((h,c)=>c%2?h+t:h+s);l.push({key:"C",data:a}),s=a[4],t=a[5];break}case"Q":l.push({key:"Q",data:[...r]}),s=r[2],t=r[3];break;case"q":{const a=r.map((h,c)=>c%2?h+t:h+s);l.push({key:"Q",data:a}),s=a[2],t=a[3];break}case"A":l.push({key:"A",data:[...r]}),s=r[5],t=r[6];break;case"a":s+=r[5],t+=r[6],l.push({key:"A",data:[r[0],r[1],r[2],r[3],r[4],s,t]});break;case"H":l.push({key:"H",data:[...r]}),s=r[0];break;case"h":s+=r[0],l.push({key:"H",data:[s]});break;case"V":l.push({key:"V",data:[...r]}),t=r[0];break;case"v":t+=r[0],l.push({key:"V",data:[t]});break;case"S":l.push({key:"S",data:[...r]}),s=r[2],t=r[3];break;case"s":{const a=r.map((h,c)=>c%2?h+t:h+s);l.push({key:"S",data:a}),s=a[2],t=a[3];break}case"T":l.push({key:"T",data:[...r]}),s=r[0],t=r[1];break;case"t":s+=r[0],t+=r[1],l.push({key:"T",data:[s,t]});break;case"Z":case"z":l.push({key:"Z",data:[]}),s=n,t=o}return l}function Ve(e){const s=[];let t="",n=0,o=0,l=0,i=0,r=0,a=0;for(const{key:h,data:c}of e){switch(h){case"M":s.push({key:"M",data:[...c]}),[n,o]=c,[l,i]=c;break;case"C":s.push({key:"C",data:[...c]}),n=c[4],o=c[5],r=c[2],a=c[3];break;case"L":s.push({key:"L",data:[...c]}),[n,o]=c;break;case"H":n=c[0],s.push({key:"L",data:[n,o]});break;case"V":o=c[0],s.push({key:"L",data:[n,o]});break;case"S":{let f=0,p=0;t==="C"||t==="S"?(f=n+(n-r),p=o+(o-a)):(f=n,p=o),s.push({key:"C",data:[f,p,...c]}),r=c[0],a=c[1],n=c[2],o=c[3];break}case"T":{const[f,p]=c;let u=0,d=0;t==="Q"||t==="T"?(u=n+(n-r),d=o+(o-a)):(u=n,d=o);const g=n+2*(u-n)/3,y=o+2*(d-o)/3,k=f+2*(u-f)/3,v=p+2*(d-p)/3;s.push({key:"C",data:[g,y,k,v,f,p]}),r=u,a=d,n=f,o=p;break}case"Q":{const[f,p,u,d]=c,g=n+2*(f-n)/3,y=o+2*(p-o)/3,k=u+2*(f-u)/3,v=d+2*(p-d)/3;s.push({key:"C",data:[g,y,k,v,u,d]}),r=f,a=p,n=u,o=d;break}case"A":{const f=Math.abs(c[0]),p=Math.abs(c[1]),u=c[2],d=c[3],g=c[4],y=c[5],k=c[6];f===0||p===0?(s.push({key:"C",data:[n,o,y,k,y,k]}),n=y,o=k):(n!==y||o!==k)&&(hs(n,o,y,k,f,p,u,d,g).forEach(function(v){s.push({key:"C",data:v})}),n=y,o=k);break}case"Z":s.push({key:"Z",data:[]}),n=l,o=i}t=h}return s}function Et(e,s,t){return[e*Math.cos(t)-s*Math.sin(t),e*Math.sin(t)+s*Math.cos(t)]}function hs(e,s,t,n,o,l,i,r,a,h){const c=(f=i,Math.PI*f/180);var f;let p=[],u=0,d=0,g=0,y=0;if(h)[u,d,g,y]=h;else{[e,s]=Et(e,s,-c),[t,n]=Et(t,n,-c);const T=(e-t)/2,O=(s-n)/2;let _=T*T/(o*o)+O*O/(l*l);_>1&&(_=Math.sqrt(_),o*=_,l*=_);const Q=o*o,L=l*l,$=Q*L-Q*O*O-L*T*T,I=Q*O*O+L*T*T,W=(r===a?-1:1)*Math.sqrt(Math.abs($/I));g=W*o*O/l+(e+t)/2,y=W*-l*T/o+(s+n)/2,u=Math.asin(parseFloat(((s-y)/l).toFixed(9))),d=Math.asin(parseFloat(((n-y)/l).toFixed(9))),e<g&&(u=Math.PI-u),t<g&&(d=Math.PI-d),u<0&&(u=2*Math.PI+u),d<0&&(d=2*Math.PI+d),a&&u>d&&(u-=2*Math.PI),!a&&d>u&&(d-=2*Math.PI)}let k=d-u;if(Math.abs(k)>120*Math.PI/180){const T=d,O=t,_=n;d=a&&d>u?u+120*Math.PI/180*1:u+120*Math.PI/180*-1,p=hs(t=g+o*Math.cos(d),n=y+l*Math.sin(d),O,_,o,l,i,0,a,[d,T,g,y])}k=d-u;const v=Math.cos(u),S=Math.sin(u),N=Math.cos(d),x=Math.sin(d),C=Math.tan(k/4),D=4/3*o*C,F=4/3*l*C,H=[e,s],B=[e+D*S,s-F*v],A=[t+D*x,n-F*N],rt=[t,n];if(B[0]=2*H[0]-B[0],B[1]=2*H[1]-B[1],h)return[B,A,rt].concat(p);{p=[B,A,rt].concat(p);const T=[];for(let O=0;O<p.length;O+=3){const _=Et(p[O][0],p[O][1],c),Q=Et(p[O+1][0],p[O+1][1],c),L=Et(p[O+2][0],p[O+2][1],c);T.push([_[0],_[1],Q[0],Q[1],L[0],L[1]])}return T}}const Us={randOffset:function(e,s){return w(e,s)},randOffsetWithRange:function(e,s,t){return Kt(e,s,t)},ellipse:function(e,s,t,n,o){const l=ds(t,n,o);return me(e,s,o,l).opset},doubleLineOps:function(e,s,t,n,o){return it(e,s,t,n,o,!0)}};function us(e,s,t,n,o){return{type:"path",ops:it(e,s,t,n,o)}}function Yt(e,s,t){const n=(e||[]).length;if(n>2){const o=[];for(let l=0;l<n-1;l++)o.push(...it(e[l][0],e[l][1],e[l+1][0],e[l+1][1],t));return s&&o.push(...it(e[n-1][0],e[n-1][1],e[0][0],e[0][1],t)),{type:"path",ops:o}}return n===2?us(e[0][0],e[0][1],e[1][0],e[1][1],t):{type:"path",ops:[]}}function tn(e,s,t,n,o){return function(l,i){return Yt(l,!0,i)}([[e,s],[e+t,s],[e+t,s+n],[e,s+n]],o)}function en(e,s){let t=Je(e,1*(1+.2*s.roughness),s);if(!s.disableMultiStroke){const n=Je(e,1.5*(1+.22*s.roughness),function(o){const l=Object.assign({},o);return l.randomizer=void 0,o.seed&&(l.seed=o.seed+1),l}(s));t=t.concat(n)}return{type:"path",ops:t}}function ds(e,s,t){const n=Math.sqrt(2*Math.PI*Math.sqrt((Math.pow(e/2,2)+Math.pow(s/2,2))/2)),o=Math.ceil(Math.max(t.curveStepCount,t.curveStepCount/Math.sqrt(200)*n)),l=2*Math.PI/o;let i=Math.abs(e/2),r=Math.abs(s/2);const a=1-t.curveFitting;return i+=w(i*a,t),r+=w(r*a,t),{increment:l,rx:i,ry:r}}function me(e,s,t,n){const[o,l]=Qe(n.increment,e,s,n.rx,n.ry,1,n.increment*Kt(.1,Kt(.4,1,t),t),t);let i=Ht(o,null,t);if(!t.disableMultiStroke&&t.roughness!==0){const[r]=Qe(n.increment,e,s,n.rx,n.ry,1.5,0,t),a=Ht(r,null,t);i=i.concat(a)}return{estimatedPoints:l,opset:{type:"path",ops:i}}}function Ge(e,s,t,n,o,l,i,r,a){const h=e,c=s;let f=Math.abs(t/2),p=Math.abs(n/2);f+=w(.01*f,a),p+=w(.01*p,a);let u=o,d=l;for(;u<0;)u+=2*Math.PI,d+=2*Math.PI;d-u>2*Math.PI&&(u=0,d=2*Math.PI);const g=2*Math.PI/a.curveStepCount,y=Math.min(g/2,(d-u)/2),k=Ue(y,h,c,f,p,u,d,1,a);if(!a.disableMultiStroke){const v=Ue(y,h,c,f,p,u,d,1.5,a);k.push(...v)}return i&&(r?k.push(...it(h,c,h+f*Math.cos(u),c+p*Math.sin(u),a),...it(h,c,h+f*Math.cos(d),c+p*Math.sin(d),a)):k.push({op:"lineTo",data:[h,c]},{op:"lineTo",data:[h+f*Math.cos(u),c+p*Math.sin(u)]})),{type:"path",ops:k}}function $t(e,s){const t=[];for(const n of e)if(n.length){const o=s.maxRandomnessOffset||0,l=n.length;if(l>2){t.push({op:"move",data:[n[0][0]+w(o,s),n[0][1]+w(o,s)]});for(let i=1;i<l;i++)t.push({op:"lineTo",data:[n[i][0]+w(o,s),n[i][1]+w(o,s)]})}}return{type:"fillPath",ops:t}}function mt(e,s){return function(t,n){let o=t.fillStyle||"hachure";if(!K[o])switch(o){case"zigzag":K[o]||(K[o]=new Hs(n));break;case"cross-hatch":K[o]||(K[o]=new Vs(n));break;case"dots":K[o]||(K[o]=new Gs(n));break;case"dashed":K[o]||(K[o]=new Zs(n));break;case"zigzag-line":K[o]||(K[o]=new Js(n));break;case"hachure":default:o="hachure",K[o]||(K[o]=new Ie(n))}return K[o]}(s,Us).fillPolygons(e,s)}function fs(e){return e.randomizer||(e.randomizer=new Qs(e.seed||0)),e.randomizer.next()}function Kt(e,s,t,n=1){return t.roughness*n*(fs(t)*(s-e)+e)}function w(e,s,t=1){return Kt(-e,e,s,t)}function it(e,s,t,n,o,l=!1){const i=l?o.disableMultiStrokeFill:o.disableMultiStroke,r=Ze(e,s,t,n,o,!0,!1);if(i)return r;const a=Ze(e,s,t,n,o,!0,!0);return r.concat(a)}function Ze(e,s,t,n,o,l,i){const r=Math.pow(e-t,2)+Math.pow(s-n,2),a=Math.sqrt(r);let h=1;h=a<200?1:a>500?.4:-.0016668*a+1.233334;let c=o.maxRandomnessOffset||0;c*c*100>r&&(c=a/10);const f=c/2,p=.2+.2*fs(o);let u=o.bowing*o.maxRandomnessOffset*(n-s)/200,d=o.bowing*o.maxRandomnessOffset*(e-t)/200;u=w(u,o,h),d=w(d,o,h);const g=[],y=()=>w(f,o,h),k=()=>w(c,o,h),v=o.preserveVertices;return l&&(i?g.push({op:"move",data:[e+(v?0:y()),s+(v?0:y())]}):g.push({op:"move",data:[e+(v?0:w(c,o,h)),s+(v?0:w(c,o,h))]})),i?g.push({op:"bcurveTo",data:[u+e+(t-e)*p+y(),d+s+(n-s)*p+y(),u+e+2*(t-e)*p+y(),d+s+2*(n-s)*p+y(),t+(v?0:y()),n+(v?0:y())]}):g.push({op:"bcurveTo",data:[u+e+(t-e)*p+k(),d+s+(n-s)*p+k(),u+e+2*(t-e)*p+k(),d+s+2*(n-s)*p+k(),t+(v?0:k()),n+(v?0:k())]}),g}function Je(e,s,t){const n=[];n.push([e[0][0]+w(s,t),e[0][1]+w(s,t)]),n.push([e[0][0]+w(s,t),e[0][1]+w(s,t)]);for(let o=1;o<e.length;o++)n.push([e[o][0]+w(s,t),e[o][1]+w(s,t)]),o===e.length-1&&n.push([e[o][0]+w(s,t),e[o][1]+w(s,t)]);return Ht(n,null,t)}function Ht(e,s,t){const n=e.length,o=[];if(n>3){const l=[],i=1-t.curveTightness;o.push({op:"move",data:[e[1][0],e[1][1]]});for(let r=1;r+2<n;r++){const a=e[r];l[0]=[a[0],a[1]],l[1]=[a[0]+(i*e[r+1][0]-i*e[r-1][0])/6,a[1]+(i*e[r+1][1]-i*e[r-1][1])/6],l[2]=[e[r+1][0]+(i*e[r][0]-i*e[r+2][0])/6,e[r+1][1]+(i*e[r][1]-i*e[r+2][1])/6],l[3]=[e[r+1][0],e[r+1][1]],o.push({op:"bcurveTo",data:[l[1][0],l[1][1],l[2][0],l[2][1],l[3][0],l[3][1]]})}if(s&&s.length===2){const r=t.maxRandomnessOffset;o.push({op:"lineTo",data:[s[0]+w(r,t),s[1]+w(r,t)]})}}else n===3?(o.push({op:"move",data:[e[1][0],e[1][1]]}),o.push({op:"bcurveTo",data:[e[1][0],e[1][1],e[2][0],e[2][1],e[2][0],e[2][1]]})):n===2&&o.push(...it(e[0][0],e[0][1],e[1][0],e[1][1],t));return o}function Qe(e,s,t,n,o,l,i,r){const a=[],h=[];if(r.roughness===0){e/=4,h.push([s+n*Math.cos(-e),t+o*Math.sin(-e)]);for(let c=0;c<=2*Math.PI;c+=e){const f=[s+n*Math.cos(c),t+o*Math.sin(c)];a.push(f),h.push(f)}h.push([s+n*Math.cos(0),t+o*Math.sin(0)]),h.push([s+n*Math.cos(e),t+o*Math.sin(e)])}else{const c=w(.5,r)-Math.PI/2;h.push([w(l,r)+s+.9*n*Math.cos(c-e),w(l,r)+t+.9*o*Math.sin(c-e)]);const f=2*Math.PI+c-.01;for(let p=c;p<f;p+=e){const u=[w(l,r)+s+n*Math.cos(p),w(l,r)+t+o*Math.sin(p)];a.push(u),h.push(u)}h.push([w(l,r)+s+n*Math.cos(c+2*Math.PI+.5*i),w(l,r)+t+o*Math.sin(c+2*Math.PI+.5*i)]),h.push([w(l,r)+s+.98*n*Math.cos(c+i),w(l,r)+t+.98*o*Math.sin(c+i)]),h.push([w(l,r)+s+.9*n*Math.cos(c+.5*i),w(l,r)+t+.9*o*Math.sin(c+.5*i)])}return[h,a]}function Ue(e,s,t,n,o,l,i,r,a){const h=l+w(.1,a),c=[];c.push([w(r,a)+s+.9*n*Math.cos(h-e),w(r,a)+t+.9*o*Math.sin(h-e)]);for(let f=h;f<=i;f+=e)c.push([w(r,a)+s+n*Math.cos(f),w(r,a)+t+o*Math.sin(f)]);return c.push([s+n*Math.cos(i),t+o*Math.sin(i)]),c.push([s+n*Math.cos(i),t+o*Math.sin(i)]),Ht(c,null,a)}function sn(e,s,t,n,o,l,i,r){const a=[],h=[r.maxRandomnessOffset||1,(r.maxRandomnessOffset||1)+.3];let c=[0,0];const f=r.disableMultiStroke?1:2,p=r.preserveVertices;for(let u=0;u<f;u++)u===0?a.push({op:"move",data:[i[0],i[1]]}):a.push({op:"move",data:[i[0]+(p?0:w(h[0],r)),i[1]+(p?0:w(h[0],r))]}),c=p?[o,l]:[o+w(h[u],r),l+w(h[u],r)],a.push({op:"bcurveTo",data:[e+w(h[u],r),s+w(h[u],r),t+w(h[u],r),n+w(h[u],r),c[0],c[1]]});return a}function Lt(e){return[...e]}function qt(e,s){return Math.pow(e[0]-s[0],2)+Math.pow(e[1]-s[1],2)}function nn(e,s,t){const n=qt(s,t);if(n===0)return qt(e,s);let o=((e[0]-s[0])*(t[0]-s[0])+(e[1]-s[1])*(t[1]-s[1]))/n;return o=Math.max(0,Math.min(1,o)),qt(e,ut(s,t,o))}function ut(e,s,t){return[e[0]+(s[0]-e[0])*t,e[1]+(s[1]-e[1])*t]}function ye(e,s,t,n){const o=n||[];if(function(r,a){const h=r[a+0],c=r[a+1],f=r[a+2],p=r[a+3];let u=3*c[0]-2*h[0]-p[0];u*=u;let d=3*c[1]-2*h[1]-p[1];d*=d;let g=3*f[0]-2*p[0]-h[0];g*=g;let y=3*f[1]-2*p[1]-h[1];return y*=y,u<g&&(u=g),d<y&&(d=y),u+d}(e,s)<t){const r=e[s+0];o.length?(l=o[o.length-1],i=r,Math.sqrt(qt(l,i))>1&&o.push(r)):o.push(r),o.push(e[s+3])}else{const a=e[s+0],h=e[s+1],c=e[s+2],f=e[s+3],p=ut(a,h,.5),u=ut(h,c,.5),d=ut(c,f,.5),g=ut(p,u,.5),y=ut(u,d,.5),k=ut(g,y,.5);ye([a,p,g,k],0,t,o),ye([k,y,d,f],0,t,o)}var l,i;return o}function on(e,s){return Vt(e,0,e.length,s)}function Vt(e,s,t,n,o){const l=o||[],i=e[s],r=e[t-1];let a=0,h=1;for(let c=s+1;c<t-1;++c){const f=nn(e[c],i,r);f>a&&(a=f,h=c)}return Math.sqrt(a)>n?(Vt(e,s,h+1,n,l),Vt(e,h,t,n,l)):(l.length||l.push(i),l.push(r)),l}function ts(e,s=.15,t){const n=[],o=(e.length-1)/3;for(let l=0;l<o;l++)ye(e,3*l,s,n);return t&&t>0?Vt(n,0,n.length,t):n}const V="none";class Gt{constructor(s){this.defaultOptions={maxRandomnessOffset:2,roughness:1,bowing:1,stroke:"#000",strokeWidth:1,curveTightness:0,curveFitting:.95,curveStepCount:9,fillStyle:"hachure",fillWeight:-1,hachureAngle:-41,hachureGap:-1,dashOffset:-1,dashGap:-1,zigzagOffset:-1,seed:0,disableMultiStroke:!1,disableMultiStrokeFill:!1,preserveVertices:!1},this.config=s||{},this.config.options&&(this.defaultOptions=this._o(this.config.options))}static newSeed(){return Math.floor(Math.random()*2**31)}_o(s){return s?Object.assign({},this.defaultOptions,s):this.defaultOptions}_d(s,t,n){return{shape:s,sets:t||[],options:n||this.defaultOptions}}line(s,t,n,o,l){const i=this._o(l);return this._d("line",[us(s,t,n,o,i)],i)}rectangle(s,t,n,o,l){const i=this._o(l),r=[],a=tn(s,t,n,o,i);if(i.fill){const h=[[s,t],[s+n,t],[s+n,t+o],[s,t+o]];i.fillStyle==="solid"?r.push($t([h],i)):r.push(mt([h],i))}return i.stroke!==V&&r.push(a),this._d("rectangle",r,i)}ellipse(s,t,n,o,l){const i=this._o(l),r=[],a=ds(n,o,i),h=me(s,t,i,a);if(i.fill)if(i.fillStyle==="solid"){const c=me(s,t,i,a).opset;c.type="fillPath",r.push(c)}else r.push(mt([h.estimatedPoints],i));return i.stroke!==V&&r.push(h.opset),this._d("ellipse",r,i)}circle(s,t,n,o){const l=this.ellipse(s,t,n,n,o);return l.shape="circle",l}linearPath(s,t){const n=this._o(t);return this._d("linearPath",[Yt(s,!1,n)],n)}arc(s,t,n,o,l,i,r=!1,a){const h=this._o(a),c=[],f=Ge(s,t,n,o,l,i,r,!0,h);if(r&&h.fill)if(h.fillStyle==="solid"){const p=Object.assign({},h);p.disableMultiStroke=!0;const u=Ge(s,t,n,o,l,i,!0,!1,p);u.type="fillPath",c.push(u)}else c.push(function(p,u,d,g,y,k,v){const S=p,N=u;let x=Math.abs(d/2),C=Math.abs(g/2);x+=w(.01*x,v),C+=w(.01*C,v);let D=y,F=k;for(;D<0;)D+=2*Math.PI,F+=2*Math.PI;F-D>2*Math.PI&&(D=0,F=2*Math.PI);const H=(F-D)/v.curveStepCount,B=[];for(let A=D;A<=F;A+=H)B.push([S+x*Math.cos(A),N+C*Math.sin(A)]);return B.push([S+x*Math.cos(F),N+C*Math.sin(F)]),B.push([S,N]),mt([B],v)}(s,t,n,o,l,i,h));return h.stroke!==V&&c.push(f),this._d("arc",c,h)}curve(s,t){const n=this._o(t),o=[],l=en(s,n);if(n.fill&&n.fill!==V&&s.length>=3){const i=ts(function(r,a=0){const h=r.length;if(h<3)throw new Error("A curve must have at least three points.");const c=[];if(h===3)c.push(Lt(r[0]),Lt(r[1]),Lt(r[2]),Lt(r[2]));else{const f=[];f.push(r[0],r[0]);for(let d=1;d<r.length;d++)f.push(r[d]),d===r.length-1&&f.push(r[d]);const p=[],u=1-a;c.push(Lt(f[0]));for(let d=1;d+2<f.length;d++){const g=f[d];p[0]=[g[0],g[1]],p[1]=[g[0]+(u*f[d+1][0]-u*f[d-1][0])/6,g[1]+(u*f[d+1][1]-u*f[d-1][1])/6],p[2]=[f[d+1][0]+(u*f[d][0]-u*f[d+2][0])/6,f[d+1][1]+(u*f[d][1]-u*f[d+2][1])/6],p[3]=[f[d+1][0],f[d+1][1]],c.push(p[1],p[2],p[3])}}return c}(s),10,(1+n.roughness)/2);n.fillStyle==="solid"?o.push($t([i],n)):o.push(mt([i],n))}return n.stroke!==V&&o.push(l),this._d("curve",o,n)}polygon(s,t){const n=this._o(t),o=[],l=Yt(s,!0,n);return n.fill&&(n.fillStyle==="solid"?o.push($t([s],n)):o.push(mt([s],n))),n.stroke!==V&&o.push(l),this._d("polygon",o,n)}path(s,t){const n=this._o(t),o=[];if(!s)return this._d("path",o,n);s=(s||"").replace(/\n/g," ").replace(/(-\s)/g,"-").replace("/(ss)/g"," ");const l=n.fill&&n.fill!=="transparent"&&n.fill!==V,i=n.stroke!==V,r=!!(n.simplification&&n.simplification<1),a=function(h,c,f){const p=Ve(He(pe(h))),u=[];let d=[],g=[0,0],y=[];const k=()=>{y.length>=4&&d.push(...ts(y,c)),y=[]},v=()=>{k(),d.length&&(u.push(d),d=[])};for(const{key:N,data:x}of p)switch(N){case"M":v(),g=[x[0],x[1]],d.push(g);break;case"L":k(),d.push([x[0],x[1]]);break;case"C":if(!y.length){const C=d.length?d[d.length-1]:g;y.push([C[0],C[1]])}y.push([x[0],x[1]]),y.push([x[2],x[3]]),y.push([x[4],x[5]]);break;case"Z":k(),d.push([g[0],g[1]])}if(v(),!f)return u;const S=[];for(const N of u){const x=on(N,f);x.length&&S.push(x)}return S}(s,1,r?4-4*n.simplification:(1+n.roughness)/2);return l&&(n.fillStyle==="solid"?o.push($t(a,n)):o.push(mt(a,n))),i&&(r?a.forEach(h=>{o.push(Yt(h,!1,n))}):o.push(function(h,c){const f=Ve(He(pe(h))),p=[];let u=[0,0],d=[0,0];for(const{key:g,data:y}of f)switch(g){case"M":{const k=1*(c.maxRandomnessOffset||0),v=c.preserveVertices;p.push({op:"move",data:y.map(S=>S+(v?0:w(k,c)))}),d=[y[0],y[1]],u=[y[0],y[1]];break}case"L":p.push(...it(d[0],d[1],y[0],y[1],c)),d=[y[0],y[1]];break;case"C":{const[k,v,S,N,x,C]=y;p.push(...sn(k,v,S,N,x,C,d,c)),d=[x,C];break}case"Z":p.push(...it(d[0],d[1],u[0],u[1],c)),d=[u[0],u[1]]}return{type:"path",ops:p}}(s,n))),this._d("path",o,n)}opsToPath(s,t){let n="";for(const o of s.ops){const l=typeof t=="number"&&t>=0?o.data.map(i=>+i.toFixed(t)):o.data;switch(o.op){case"move":n+=`M${l[0]} ${l[1]} `;break;case"bcurveTo":n+=`C${l[0]} ${l[1]}, ${l[2]} ${l[3]}, ${l[4]} ${l[5]} `;break;case"lineTo":n+=`L${l[0]} ${l[1]} `}}return n.trim()}toPaths(s){const t=s.sets||[],n=s.options||this.defaultOptions,o=[];for(const l of t){let i=null;switch(l.type){case"path":i={d:this.opsToPath(l),stroke:n.stroke,strokeWidth:n.strokeWidth,fill:V};break;case"fillPath":i={d:this.opsToPath(l),stroke:V,strokeWidth:0,fill:n.fill||V};break;case"fillSketch":i=this.fillSketch(l,n)}i&&o.push(i)}return o}fillSketch(s,t){let n=t.fillWeight;return n<0&&(n=t.strokeWidth/2),{d:this.opsToPath(s),stroke:t.fill||V,strokeWidth:n,fill:V}}}class rn{constructor(s,t){this.canvas=s,this.ctx=this.canvas.getContext("2d"),this.gen=new Gt(t)}draw(s){const t=s.sets||[],n=s.options||this.getDefaultOptions(),o=this.ctx,l=s.options.fixedDecimalPlaceDigits;for(const i of t)switch(i.type){case"path":o.save(),o.strokeStyle=n.stroke==="none"?"transparent":n.stroke,o.lineWidth=n.strokeWidth,n.strokeLineDash&&o.setLineDash(n.strokeLineDash),n.strokeLineDashOffset&&(o.lineDashOffset=n.strokeLineDashOffset),this._drawToContext(o,i,l),o.restore();break;case"fillPath":{o.save(),o.fillStyle=n.fill||"";const r=s.shape==="curve"||s.shape==="polygon"||s.shape==="path"?"evenodd":"nonzero";this._drawToContext(o,i,l,r),o.restore();break}case"fillSketch":this.fillSketch(o,i,n)}}fillSketch(s,t,n){let o=n.fillWeight;o<0&&(o=n.strokeWidth/2),s.save(),n.fillLineDash&&s.setLineDash(n.fillLineDash),n.fillLineDashOffset&&(s.lineDashOffset=n.fillLineDashOffset),s.strokeStyle=n.fill||"",s.lineWidth=o,this._drawToContext(s,t,n.fixedDecimalPlaceDigits),s.restore()}_drawToContext(s,t,n,o="nonzero"){s.beginPath();for(const l of t.ops){const i=typeof n=="number"&&n>=0?l.data.map(r=>+r.toFixed(n)):l.data;switch(l.op){case"move":s.moveTo(i[0],i[1]);break;case"bcurveTo":s.bezierCurveTo(i[0],i[1],i[2],i[3],i[4],i[5]);break;case"lineTo":s.lineTo(i[0],i[1])}}t.type==="fillPath"?s.fill(o):s.stroke()}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}line(s,t,n,o,l){const i=this.gen.line(s,t,n,o,l);return this.draw(i),i}rectangle(s,t,n,o,l){const i=this.gen.rectangle(s,t,n,o,l);return this.draw(i),i}ellipse(s,t,n,o,l){const i=this.gen.ellipse(s,t,n,o,l);return this.draw(i),i}circle(s,t,n,o){const l=this.gen.circle(s,t,n,o);return this.draw(l),l}linearPath(s,t){const n=this.gen.linearPath(s,t);return this.draw(n),n}polygon(s,t){const n=this.gen.polygon(s,t);return this.draw(n),n}arc(s,t,n,o,l,i,r=!1,a){const h=this.gen.arc(s,t,n,o,l,i,r,a);return this.draw(h),h}curve(s,t){const n=this.gen.curve(s,t);return this.draw(n),n}path(s,t){const n=this.gen.path(s,t);return this.draw(n),n}}const Xt="http://www.w3.org/2000/svg";class ln{constructor(s,t){this.svg=s,this.gen=new Gt(t)}draw(s){const t=s.sets||[],n=s.options||this.getDefaultOptions(),o=this.svg.ownerDocument||window.document,l=o.createElementNS(Xt,"g"),i=s.options.fixedDecimalPlaceDigits;for(const r of t){let a=null;switch(r.type){case"path":a=o.createElementNS(Xt,"path"),a.setAttribute("d",this.opsToPath(r,i)),a.setAttribute("stroke",n.stroke),a.setAttribute("stroke-width",n.strokeWidth+""),a.setAttribute("fill","none"),n.strokeLineDash&&a.setAttribute("stroke-dasharray",n.strokeLineDash.join(" ").trim()),n.strokeLineDashOffset&&a.setAttribute("stroke-dashoffset",`${n.strokeLineDashOffset}`);break;case"fillPath":a=o.createElementNS(Xt,"path"),a.setAttribute("d",this.opsToPath(r,i)),a.setAttribute("stroke","none"),a.setAttribute("stroke-width","0"),a.setAttribute("fill",n.fill||""),s.shape!=="curve"&&s.shape!=="polygon"||a.setAttribute("fill-rule","evenodd");break;case"fillSketch":a=this.fillSketch(o,r,n)}a&&l.appendChild(a)}return l}fillSketch(s,t,n){let o=n.fillWeight;o<0&&(o=n.strokeWidth/2);const l=s.createElementNS(Xt,"path");return l.setAttribute("d",this.opsToPath(t,n.fixedDecimalPlaceDigits)),l.setAttribute("stroke",n.fill||""),l.setAttribute("stroke-width",o+""),l.setAttribute("fill","none"),n.fillLineDash&&l.setAttribute("stroke-dasharray",n.fillLineDash.join(" ").trim()),n.fillLineDashOffset&&l.setAttribute("stroke-dashoffset",`${n.fillLineDashOffset}`),l}get generator(){return this.gen}getDefaultOptions(){return this.gen.defaultOptions}opsToPath(s,t){return this.gen.opsToPath(s,t)}line(s,t,n,o,l){const i=this.gen.line(s,t,n,o,l);return this.draw(i)}rectangle(s,t,n,o,l){const i=this.gen.rectangle(s,t,n,o,l);return this.draw(i)}ellipse(s,t,n,o,l){const i=this.gen.ellipse(s,t,n,o,l);return this.draw(i)}circle(s,t,n,o){const l=this.gen.circle(s,t,n,o);return this.draw(l)}linearPath(s,t){const n=this.gen.linearPath(s,t);return this.draw(n)}polygon(s,t){const n=this.gen.polygon(s,t);return this.draw(n)}arc(s,t,n,o,l,i,r=!1,a){const h=this.gen.arc(s,t,n,o,l,i,r,a);return this.draw(h)}curve(s,t){const n=this.gen.curve(s,t);return this.draw(n)}path(s,t){const n=this.gen.path(s,t);return this.draw(n)}}var an={canvas:(e,s)=>new rn(e,s),svg:(e,s)=>new ln(e,s),generator:e=>new Gt(e),newSeed:()=>Gt.newSeed()},cn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ps={exports:{}};/*!
 * Toastify js 1.12.0
 * https://github.com/apvarun/toastify-js
 * @license MIT licensed
 *
 * Copyright (C) 2018 Varun A P
 */(function(e){(function(s,t){e.exports?e.exports=t():s.Toastify=t()})(cn,function(s){var t=function(i){return new t.lib.init(i)},n="1.12.0";t.defaults={oldestFirst:!0,text:"Toastify is awesome!",node:void 0,duration:3e3,selector:void 0,callback:function(){},destination:void 0,newWindow:!1,close:!1,gravity:"toastify-top",positionLeft:!1,position:"",backgroundColor:"",avatar:"",className:"",stopOnFocus:!0,onClick:function(){},offset:{x:0,y:0},escapeMarkup:!0,ariaLive:"polite",style:{background:""}},t.lib=t.prototype={toastify:n,constructor:t,init:function(i){return i||(i={}),this.options={},this.toastElement=null,this.options.text=i.text||t.defaults.text,this.options.node=i.node||t.defaults.node,this.options.duration=i.duration===0?0:i.duration||t.defaults.duration,this.options.selector=i.selector||t.defaults.selector,this.options.callback=i.callback||t.defaults.callback,this.options.destination=i.destination||t.defaults.destination,this.options.newWindow=i.newWindow||t.defaults.newWindow,this.options.close=i.close||t.defaults.close,this.options.gravity=i.gravity==="bottom"?"toastify-bottom":t.defaults.gravity,this.options.positionLeft=i.positionLeft||t.defaults.positionLeft,this.options.position=i.position||t.defaults.position,this.options.backgroundColor=i.backgroundColor||t.defaults.backgroundColor,this.options.avatar=i.avatar||t.defaults.avatar,this.options.className=i.className||t.defaults.className,this.options.stopOnFocus=i.stopOnFocus===void 0?t.defaults.stopOnFocus:i.stopOnFocus,this.options.onClick=i.onClick||t.defaults.onClick,this.options.offset=i.offset||t.defaults.offset,this.options.escapeMarkup=i.escapeMarkup!==void 0?i.escapeMarkup:t.defaults.escapeMarkup,this.options.ariaLive=i.ariaLive||t.defaults.ariaLive,this.options.style=i.style||t.defaults.style,i.backgroundColor&&(this.options.style.background=i.backgroundColor),this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var i=document.createElement("div");i.className="toastify on "+this.options.className,this.options.position?i.className+=" toastify-"+this.options.position:this.options.positionLeft===!0?(i.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):i.className+=" toastify-right",i.className+=" "+this.options.gravity,this.options.backgroundColor&&console.warn('DEPRECATION NOTICE: "backgroundColor" is being deprecated. Please use the "style.background" property.');for(var r in this.options.style)i.style[r]=this.options.style[r];if(this.options.ariaLive&&i.setAttribute("aria-live",this.options.ariaLive),this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)i.appendChild(this.options.node);else if(this.options.escapeMarkup?i.innerText=this.options.text:i.innerHTML=this.options.text,this.options.avatar!==""){var a=document.createElement("img");a.src=this.options.avatar,a.className="toastify-avatar",this.options.position=="left"||this.options.positionLeft===!0?i.appendChild(a):i.insertAdjacentElement("afterbegin",a)}if(this.options.close===!0){var h=document.createElement("button");h.type="button",h.setAttribute("aria-label","Close"),h.className="toast-close",h.innerHTML="&#10006;",h.addEventListener("click",function(y){y.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var c=window.innerWidth>0?window.innerWidth:screen.width;(this.options.position=="left"||this.options.positionLeft===!0)&&c>360?i.insertAdjacentElement("afterbegin",h):i.appendChild(h)}if(this.options.stopOnFocus&&this.options.duration>0){var f=this;i.addEventListener("mouseover",function(y){window.clearTimeout(i.timeOutValue)}),i.addEventListener("mouseleave",function(){i.timeOutValue=window.setTimeout(function(){f.removeElement(i)},f.options.duration)})}if(typeof this.options.destination<"u"&&i.addEventListener("click",function(y){y.stopPropagation(),this.options.newWindow===!0?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),typeof this.options.onClick=="function"&&typeof this.options.destination>"u"&&i.addEventListener("click",function(y){y.stopPropagation(),this.options.onClick()}.bind(this)),typeof this.options.offset=="object"){var p=o("x",this.options),u=o("y",this.options),d=this.options.position=="left"?p:"-"+p,g=this.options.gravity=="toastify-top"?u:"-"+u;i.style.transform="translate("+d+","+g+")"}return i},showToast:function(){this.toastElement=this.buildToast();var i;if(typeof this.options.selector=="string"?i=document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||typeof ShadowRoot<"u"&&this.options.selector instanceof ShadowRoot?i=this.options.selector:i=document.body,!i)throw"Root element is not defined";var r=t.defaults.oldestFirst?i.firstChild:i.lastChild;return i.insertBefore(this.toastElement,r),t.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(i){i.className=i.className.replace(" on",""),window.setTimeout(function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),i.parentNode&&i.parentNode.removeChild(i),this.options.callback.call(i),t.reposition()}.bind(this),400)}},t.reposition=function(){for(var i={top:15,bottom:15},r={top:15,bottom:15},a={top:15,bottom:15},h=document.getElementsByClassName("toastify"),c,f=0;f<h.length;f++){l(h[f],"toastify-top")===!0?c="toastify-top":c="toastify-bottom";var p=h[f].offsetHeight;c=c.substr(9,c.length-1);var u=15,d=window.innerWidth>0?window.innerWidth:screen.width;d<=360?(h[f].style[c]=a[c]+"px",a[c]+=p+u):l(h[f],"toastify-left")===!0?(h[f].style[c]=i[c]+"px",i[c]+=p+u):(h[f].style[c]=r[c]+"px",r[c]+=p+u)}return this};function o(i,r){return r.offset[i]?isNaN(r.offset[i])?r.offset[i]:r.offset[i]+"px":"0px"}function l(i,r){return!i||typeof r!="string"?!1:!!(i.className&&i.className.trim().split(/\s+/gi).indexOf(r)>-1)}return t.lib.init.prototype=t.lib,t})})(ps);const ge=ps.exports;var ke;(e=>{})(ke||(ke={}));const J=document.getElementById("canvas");J.height=document.documentElement.clientHeight;J.width=document.documentElement.clientWidth;const b=J.getContext("2d");b.lineWidth=12;b.fillStyle="rgb(54, 79, 199)";let ue=0,de=0;const st=an.canvas(J);let z=[],M=0,P=0,ms=0,ys=0,hn=1,be=0,kt=[],m=1,Zt=!1,Jt=!1,we=!1,Te=!1,Y=!1,Me=!1;const ht=document.getElementById("me");ht.id==="me"&&(ht.style.opacity="0");const G=Le(20);let wt="rgb(95, 61, 196)",ft="pointer",Tt="hachure",ve="10rem",Qt="";const zt=document.getElementById("zoom-current"),ze=document.querySelector(".confirm-wrapper"),gs=document.querySelector(".main-container"),at=document.querySelector(".options-wrapper"),St=document.getElementById("options-color-fill"),xe=document.getElementById("options-color-border"),Pe=document.getElementById("fill-style-options-container"),ks=document.getElementById("font-size-options-container"),bs=document.getElementById("options-color-text"),Ct=document.getElementById("width-options-container"),Rt=document.getElementById("opacity-options-container"),un=document.querySelector(".settings-show-btn"),It=document.querySelector(".settings-container");un.addEventListener("click",()=>{It.style.display==="none"?It.style.display="flex":It.style.display="none"});const ws=localStorage.getItem("theme")||"darkTheme",dn=document.getElementById("change-theme-btn"),Ut=document.getElementById("theme-inner-text"),te=document.getElementById("moon-icon-container"),ee=document.getElementById("sun-icon-container");document.documentElement.className=ws;ws==="darkTheme"?(Ut.innerHTML="\u0421\u0432\u0435\u0442\u043B\u0430\u044F \u0442\u0435\u043C\u0430",ee.style.display="block",te.style.display="none"):(Ut.innerHTML="\u0422\u0435\u043C\u043D\u0430\u044F \u0442\u0435\u043C\u0430",ee.style.display="none",te.style.display="block");dn.addEventListener("click",Ms);const es=document.querySelectorAll(".fill-style-btn");es.forEach(e=>{e.addEventListener("click",s=>{if(s.target===null)return;const t=s.target;es.forEach(n=>{n!==t&&n.classList.remove("active-fill-style")}),t.classList.add("active-fill-style"),Tt=t.dataset.fillOption})});const Wt=document.querySelectorAll(".top-btn");Wt.forEach(e=>{e.addEventListener("click",s=>{if(s.target===null)return;const t=s.target;t.id==="save-btn"||t.id==="clear-btn"||(Wt.forEach(n=>{n!==t&&n.classList.remove("active-shape")}),t.classList.add("active-shape"),ft=t.dataset.shapeOption,et(t.id))})});let j=ke.socket,Nt="";const se=window.location,Ee={background:document.documentElement.className==="lightTheme"?"rgba(255, 255, 255, 0.8)":"rgba(49, 49, 49, 0.8)",color:document.documentElement.className==="lightTheme"?"rgb(51, 51, 51)":"rgb(233, 233, 233)",border:"2px solid rgb(95, 61, 196)",borderRadius:"5px",boxShadow:"none",fill:"red"};se.protocol==="https:"?Nt="wss:":Nt="ws:";Nt+="/"+se.host;Nt+=se.pathname+"/ws"+se.search;j=new WebSocket(Nt);fn(j);function fn(e){e.onmessage=pn,e.onclose=mn}function pn(e){try{const t=e.data.split(":::");switch(t[0]){case"move":{const o=b.lineWidth,l=b.strokeStyle;J.getContext("2d"),b.beginPath(),b.moveTo(t[1],t[2]),b.lineTo(t[3],t[4]),b.lineWidth=t[5],b.strokeStyle=t[6],b.stroke(),b.strokeStyle=l,b.lineWidth=o;break}case"clear":{z=[],b.clearRect(0,0,J.width,J.height);break}case"cur":{const o=t[1];let l;if(l=document.getElementById(o),l===null){l=document.createElement("div"),l.id=o,l.className="trailer",document.body.appendChild(l);return}const i={transform:`translate(${+t[2]*m+M}px, ${+t[3]*m+P}px)`};l.animate(i,{fill:"forwards"});break}case"disconnect":{ge({text:"\u041F\u043E\u043B\u044C\u0437\u043E\u0432\u0430\u0442\u0435\u043B\u044C \u043E\u0442\u043A\u043B\u044E\u0447\u0438\u043B\u0441\u044F",duration:2e3,newWindow:!0,close:!0,gravity:"bottom",position:"right",stopOnFocus:!0,style:Ee,onClick:function(){}}).showToast();let o=document.getElementsByClassName("trailer");if(o.length===0)return;for(var s=0;s<o.length;s++)o[s].id!=="me"&&(document.body.removeChild(o[s]),s--);break}case"message":{ge({text:t[1],duration:6e3,newWindow:!0,close:!0,gravity:"bottom",position:"right",stopOnFocus:!0,style:Ee,onClick:function(){}}).showToast();break}case"drawObj":{let o=Xs(t[1],st,b);if(o.typeName==="text"){let l=o,i=document.querySelectorAll("#"+l.inputId);for(let a=0;a<i.length;a++)i[a].remove();const r=document.createElement("textarea");r.id=l.inputId,r.classList.add("text-element"),gs.prepend(r),r.addEventListener("input",Ps),r.value=l.text,l.inputElement=r}o.zoom=m,z.push(o),o.draw(M,P);break}case"delete":{let o=t[1];z=z.filter(l=>l.objId!==JSON.parse(o).objId),X();break}default:break}}catch(t){console.error(t)}}function mn(){ge({text:"\u0421\u043E\u0435\u0434\u0438\u043D\u0435\u043D\u0438\u0435 \u043F\u0440\u0435\u0440\u0432\u0430\u043D\u043E. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u0437\u0434\u0435\u0441\u044C.",duration:0,newWindow:!0,close:!1,gravity:"bottom",position:"right",stopOnFocus:!0,style:Ee,onClick:function(){location.reload()}}).showToast()}window.addEventListener("keydown",e=>{const s=e.ctrlKey&&e.shiftKey&&e.key==="T",t=e.ctrlKey&&e.key.toLowerCase()==="d",n=e.ctrlKey&&e.shiftKey&&e.key==="O";e.code==="Space"&&(Te=!0),s&&(e.preventDefault(),Ms()),t&&(e.preventDefault(),vs()),n&&(e.preventDefault(),xs())});window.addEventListener("keyup",e=>{e.code==="Space"&&(Te=!1)});let q=0,R=0;window.addEventListener("pointerdown",e=>{var s;if(e.stopPropagation(),e.button===1||Te&&e.button===0){Jt=!0,ms=e.clientX-M,ys=e.clientY-P;return}if(e.button===0){const t=e.target;if(t.id!=="canvas"){we=!1;return}if(t===null)return;if(Zt=!0,we=!0,be=0,kt=[],q=e.clientX,R=e.clientY,ft==="text"){const n=document.createElement("textarea"),o=Le(5);n.id=o,n.classList.add("text-element"),n.style.fontSize=ve,n.style.color=Qt,n.style.border="none",n.style.outline="2px dashed rgba(0, 0, 0, 0.5)";let l=new cs("Roboto",b.fillStyle,G,n,(e.clientY-P)/m,(e.clientX-M)/m,"",n.id,ve,Qt,500,150);l.zoom=m,l.draw(M,P),z.push(l);let i="drawObj:::"+JSON.stringify(l)+":::";j.send(i.length),j.send(i),gs.prepend(n),n.addEventListener("focus",r=>{n.style.outline="2px solid black",Me=!0}),n.addEventListener("blur",r=>{n.value.length!==0&&(n.style.outline="none"),Me=!1}),n.addEventListener("input",Ps),n.addEventListener("resize",Pn),new ResizeObserver(yn).observe(n),ft="pointer",Wt.forEach(r=>{r.classList.remove("active-shape")}),(s=document.getElementById("pointer-btn"))==null||s.classList.add("active-shape")}}});function yn(){}window.addEventListener("pointerup",e=>{if(e.button,e.button===2)return;if(Jt){Jt=!1;return}if(Zt=!1,e.target.id!=="canvas"||we===!1)return;switch(ft){case"image":return;case"text":return;case"pointer":return;case"pen":{let n=[];for(let l=0;l<kt.length;l++){const i=kt[l];n.push([i[0]*m,i[1]*m])}let o=new Se(kt,b.fillStyle,+b.lineWidth,b,G);o.zoom=m,z.push(o),X();break}case"line":{X();let n=new Ot(b.fillStyle,+b.lineWidth,[(q-M)/m,(R-P)/m],[(e.clientX-M)/m,(e.clientY-P)/m],st,G);n.zoom=m,z.push(n),X();break}case"rectangle":{X();let n=new Ce(b.fillStyle,+b.lineWidth,[(q-M)/m,(R-P)/m],[(e.shiftKey,(e.clientX-M)/m),e.shiftKey?(R-P)/m+((e.clientX-M)/m-(q-M)/m):(e.clientY-P)/m],Tt,st,wt,b.lineWidth,G);n.zoom=m,n.draw(M,P),z.push(n);break}case"ellipse":{X();let n=new Oe(b.fillStyle,+b.lineWidth,[(q-M)/m,(R-P)/m],[(e.shiftKey,(e.clientX-M)/m),e.shiftKey?(R-P)/m+((e.clientX-M)/m-(q-M)/m):(e.clientY-P)/m],Tt,st,wt,b.lineWidth,!1,G);n.zoom=m,n.draw(M,P),z.push(n);break}}let t="drawObj:::"+JSON.stringify(z[z.length-1])+":::";j.send(t.length),j.send(t)});window.addEventListener("pointermove",e=>{const s=e.target,t=e.clientX-ht.offsetWidth/2,n=e.clientY-ht.offsetHeight/2;if(s.id==="canvas"){Ys(t,n,ht);let i="cur:::"+G+":::"+ +(e.clientX/m-M/m)+":::"+ +(e.clientY/m-P/m)+":::";j.send(i.length),j.send(i)}if(Jt){M=e.clientX-ms,P=e.clientY-ys,X();return}if(!Zt)return;const o=e.clientX,l=e.clientY;switch(ft){case"pointer":break;case"eraser":{let i=z.length;z=z.filter(r=>{if(r.typeName==="curve"){if(r.isCloseToPoints(e.clientX/m-M/m,e.clientY/m-P/m,10))return gt(r),!1}else if(r.typeName==="rectangle"){if(r.isOverlay(-e.clientX+M,-e.clientY+P,1,1))return gt(r),!1}else if(r.typeName==="line"){if(r.isCloseToPoints(e.clientX/m-M/m,e.clientY/m-P/m,25))return gt(r),!1}else if(r.typeName==="ellipse"&&r.closeToCentre(e.clientX/m-M/m,e.clientY/m-P/m))return gt(r),!1;return!0}),i!==z.length&&X();break}case"pen":{if(ue==null||de==null||!Zt){ue=e.clientX,de=e.clientY;return}let i=e.clientX,r=e.clientY;if(be++,be%hn===0){kt.push([(i-M)/m,(r-P)/m]),X();let a=new Se(kt,b.fillStyle,b.lineWidth,b,G);a.zoom=m,a.draw(M,P)}ue=i,de=r;break}case"rectangle":{X(),e.shiftKey;let i=new Ce(b.fillStyle,+b.lineWidth,[(q-M)/m,(R-P)/m],[(e.shiftKey,(o-M)/m),e.shiftKey?(R-P)/m+((o-M)/m-(q-M)/m):(l-P)/m],Tt,st,wt,b.lineWidth,G);i.zoom=m,i.draw(M,P);break}case"line":{X();let i;if(e.shiftKey){const r=(l-R)/(o-q);Math.abs(r)<=1?i=new Ot(b.fillStyle,+b.lineWidth,[(q-M)/m,(R-P)/m],[(o-M)/m,(R-P)/m],st,G):i=new Ot(b.fillStyle,+b.lineWidth,[(q-M)/m,(R-P)/m],[(q-M)/m,(l-P)/m],st,G)}else i=new Ot(b.fillStyle,+b.lineWidth,[(q-M)/m,(R-P)/m],[(o-M)/m,(l-P)/m],st,G);i.zoom=m,i.draw(M,P);break}case"ellipse":{X();let i=new Oe(b.fillStyle,+b.lineWidth,[(q-M)/m,(R-P)/m],[(e.shiftKey,(e.clientX-M)/m),e.shiftKey?(R-P)/m+((e.clientX-M)/m-(q-M)/m):(e.clientY-P)/m],Tt,st,wt,b.lineWidth,!1,G);i.zoom=m,i.draw(M,P);break}}});window.addEventListener("resize",()=>{let e=b.strokeStyle,s=b.fillStyle,t=b.lineWidth;J.height=window.innerHeight,J.width=window.innerWidth,b.strokeStyle=e,b.fillStyle=s,b.lineWidth=t,X()});window.addEventListener("wheel",e=>{let s=e.clientX,t=e.clientY,n=(M+(m-1)*s)/m,o=(P+(m-1)*t)/m;m+=e.deltaY<0?.05:-.1,m<=.1?m=.1:m>=5&&(m=5),e.deltaY<0,M=n+(m-1)*(n-s),P=o+(m-1)*(o-t),ie(),X(),zt.innerHTML=`${Math.floor(m*100)}%`});let _t=[];document.addEventListener("keydown",e=>{const s=e.key.toLowerCase(),t=e.code;if(e.ctrlKey&&t==="KeyZ"){if(e.shiftKey){if(_t.length===0)return;let a=_t.pop();z.push(a),a.draw(M,P);let h="drawObj:::"+JSON.stringify(a)+":::";j.send(h.length),j.send(h);return}let o=z.filter(a=>a.userId===G);if(o.length===0)return;let l=o[o.length-1];z=z.filter(a=>a!==l);let i=JSON.stringify(l);_t.push(l),X();let r="delete:::"+i;j.send(r.length),j.send(r)}if(!(e.ctrlKey&&e.shiftKey)&&Y!==!0&&Me!==!0){if(s==="1"||t==="KeyF"){const o="pointer-btn";ct(o),et(o)}if(s==="2"||t==="KeyE"){const o="eraser-btn";ct(o),et(o)}if(s==="3"||t==="KeyP"){const o="pen-btn";ct(o),et(o)}if(s==="4"||t==="KeyR"){const o="rectangle-btn";ct(o),et(o)}if(s==="5"||t==="KeyV"){const o="line-btn";ct(o),et(o)}if(s==="6"||t==="KeyC"){const o="ellipse-btn";ct(o),et(o)}if(s==="7"||t==="KeyT"){const o="text-btn";ct(o),et(o)}if(s==="8"||t==="KeyI"){const o="image-btn";ct(o),et(o)}}});const gn=document.getElementById("save-btn");gn.addEventListener("click",vs);const kn=document.getElementById("clear-btn");kn.addEventListener("click",()=>{ze.style.display="flex"});const bn=document.getElementById("save-server-btn");bn.addEventListener("click",xs);const wn=document.getElementById("confirm-agree"),Mn=document.getElementById("confirm-cancel");Mn.addEventListener("click",()=>{ze.style.display="none"});wn.addEventListener("click",()=>{var e;z=[],b.clearRect(0,0,J.width,J.height),j.send(8),j.send("clear:::"),It.style.display="none",ft="pointer",Wt.forEach(s=>{s.classList.remove("active-shape")}),(e=document.getElementById("pointer-btn"))==null||e.classList.add("active-shape"),ze.style.display="none"});const We=document.querySelector(".color-picker"),nt=document.getElementById("color-list"),ss=document.querySelectorAll("#color-item"),Ne=document.getElementById("color-picker-input"),Be=document.getElementById("stroke-color-picker"),ot=document.getElementById("stroke-color-list"),ns=document.querySelectorAll("#stroke-color-item"),je=document.getElementById("stroke-color-picker-input"),De=document.getElementById("text-color-picker"),dt=document.getElementById("text-color-list"),os=document.querySelectorAll("#text-color-item"),Ae=document.getElementById("text-color-picker-input");De.addEventListener("click",e=>{Y===!0?Y=!1:Y=!0,ot.style.display="none",nt.style.display="none",e.stopPropagation(),dt.style.display==="grid"?dt.style.display="none":dt.style.display="grid"});for(let e=0;e<os.length;e++)os[e].addEventListener("click",t=>{const n=t.target;if(n===null)return;const o=n.style.backgroundColor;De.style.backgroundColor=o,Qt=o,dt.style.display="none"});Ae.addEventListener("input",e=>{const s=e.target;if(s===null)return;const t="#"+s.value;t.length>1&&(De.style.backgroundColor=t,Qt=ne(t,bt.value))});Ae.addEventListener("focus",()=>{Y=!0});Ae.addEventListener("blur",()=>{Y=!1});document.documentElement.addEventListener("click",e=>{dt.style.display==="grid"&&e.target!==dt&&(dt.style.display="none")});We.addEventListener("click",e=>{Y===!0?Y=!1:Y=!0,ot.style.display="none",e.stopPropagation(),nt.style.display==="grid"?nt.style.display="none":nt.style.display="grid"});for(let e=0;e<ss.length;e++)ss[e].addEventListener("click",t=>{const n=t.target;if(n===null)return;const o=n.style.backgroundColor;We.style.backgroundColor=o,qs(o,b,ht,+bt.value),nt.style.display="none",ht.style.backgroundColor=n.style.backgroundColor});Ne.addEventListener("input",e=>{const s=e.target;if(s===null)return;const t="#"+s.value;t.length>1&&(We.style.backgroundColor=t,b.fillStyle=ne(t,bt.value),ht.style.backgroundColor=t)});Ne.addEventListener("focus",()=>{Y=!0});Ne.addEventListener("blur",()=>{Y=!1});document.documentElement.addEventListener("click",e=>{nt.style.display==="grid"&&e.target!==nt&&(nt.style.display="none")});Be.addEventListener("click",e=>{Y===!0?Y=!1:Y=!0,nt.style.display="none",e.stopPropagation(),ot.style.display==="grid"?ot.style.display="none":ot.style.display="grid"});for(let e=0;e<ns.length;e++)ns[e].addEventListener("click",t=>{const n=t.target;if(n===null)return;const o=n.style.backgroundColor;Be.style.backgroundColor=o,wt=o,ot.style.display="none"});je.addEventListener("input",e=>{const s=e.target;if(s===null)return;const t="#"+s.value;t.length>1&&(Be.style.backgroundColor=t,wt=t)});je.addEventListener("focus",()=>{Y=!0});je.addEventListener("blur",()=>{Y=!1});document.documentElement.addEventListener("click",e=>{ot.style.display==="grid"&&e.target!==ot&&(ot.style.display="none")});const is=document.querySelectorAll(".width-btn");is.forEach(e=>{e.addEventListener("click",s=>{if(s.target===null)return;const t=s.target;b.lineWidth=parseInt(t.dataset.lineWidth),e.classList.add("active-option"),is.forEach(n=>{n!==t&&n.classList.remove("active-option")})})});const bt=document.getElementById("input-opacity");bt.addEventListener("change",()=>{const e=b.fillStyle.startsWith("#")?ne(b.fillStyle,bt.value):as(b.fillStyle,+bt.value);b.fillStyle=e});const vn=document.getElementById("zoom-decrease"),xn=document.getElementById("zoom-increase");vn.addEventListener("click",()=>{m-=.1,m<=.1&&(m=.1),ie(),X(),zt.innerHTML=`${Math.floor(m*100)}%`});xn.addEventListener("click",()=>{m+=.1,m>=5&&(m=5),ie(),X(),zt.innerHTML=`${Math.floor(m*100)}%`});zt.addEventListener("click",e=>{e.stopPropagation(),m=1,ie(),X(),zt.innerHTML="100%"});const rs=document.querySelectorAll(".font-size-btn");rs.forEach(e=>{e.addEventListener("click",s=>{if(s.target===null)return;const t=s.target;ve=t.dataset.fontSize,e.classList.add("active-option"),rs.forEach(n=>{n!==t&&n.classList.remove("active-option")})})});function gt(e){_t.push(e);let t="delete:::"+JSON.stringify(e),o=new TextEncoder().encode(t);j.send(o.length),j.send(o)}function X(){_s(b),Ks(z,M,P,document.documentElement.clientWidth,document.documentElement.clientHeight)}function ie(){for(let e=0;e<z.length;e++){const s=z[e];s.zoom=m}}function et(e){switch(e.split("-")[0]){case"pointer":at.style.display="none";break;case"eraser":at.style.display="none";break;case"pen":yt(),at.style.display="flex",St.style.display="flex",Rt.style.display="flex",Ct.style.display="flex";break;case"rectangle":yt(),at.style.display="flex",St.style.display="flex",xe.style.display="flex",Pe.style.display="flex",Rt.style.display="flex",Ct.style.display="flex";break;case"line":yt(),at.style.display="flex",St.style.display="flex",Rt.style.display="flex",Ct.style.display="flex";break;case"ellipse":yt(),at.style.display="flex",xe.style.display="flex",Pe.style.display="flex",Ct.style.display="flex",St.style.display="flex";break;case"text":yt(),at.style.display="flex",bs.style.display="flex",ks.style.display="flex";break;case"image":yt(),at.style.display="none";break}}function yt(){St.style.display="none",xe.style.display="none",bs.style.display="none",Pe.style.display="none",ks.style.display="none",Ct.style.display="none",Rt.style.display="none"}function Ms(){const e=document.documentElement.className;e.includes("darkTheme")&&(Ut.innerHTML="\u0422\u0435\u043C\u043D\u0430\u044F \u0442\u0435\u043C\u0430",document.documentElement.className="lightTheme",localStorage.setItem("theme","lightTheme"),ee.style.display="none",te.style.display="block"),e.includes("lightTheme")&&(Ut.innerHTML="\u0421\u0432\u0435\u0442\u043B\u0430\u044F \u0442\u0435\u043C\u0430",document.documentElement.className="darkTheme",localStorage.setItem("theme","darkTheme"),ee.style.display="block",te.style.display="none")}function vs(){let e=J.toDataURL("imag/png"),s=document.createElement("a");s.href=e,s.download="sketch.png",s.click()}function xs(){let e="save";j.send(e.length),j.send(e),It.style.display="none"}function ct(e){const s=document.getElementById(e);Wt.forEach(t=>{t!==s&&t.classList.remove("active-shape")}),s.classList.add("active-shape"),ft=s.dataset.shapeOption}function Pn(e){const s=e.target,t=z.find(i=>i.inputId===s.id);t.width=+s.style.width,t.height=+s.style.height,gt(t);let n="drawObj:::"+JSON.stringify(t)+":::",l=new TextEncoder().encode(n);j.send(l.length),j.send(l)}function Ps(e){const s=e.target;if(s.value.length>1e3)return;const t=z.find(i=>i.inputId===s.id);t.text=s.value,gt(t);let n="drawObj:::"+JSON.stringify(t)+":::",l=new TextEncoder().encode(n);j.send(l.length),j.send(l)}
