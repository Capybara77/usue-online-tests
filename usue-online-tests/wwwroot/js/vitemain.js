(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))c(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&c(d)}).observe(document,{childList:!0,subtree:!0});function n(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerpolicy&&(o.referrerPolicy=l.referrerpolicy),l.crossorigin==="use-credentials"?o.credentials="include":l.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(l){if(l.ep)return;l.ep=!0;const o=n(l);fetch(l.href,o)}})();function Ee(e,t,n,c=l=>l){return e*c(.5-t*(.5-n))}function $e(e){return[-e[0],-e[1]]}function k(e,t){return[e[0]+t[0],e[1]+t[1]]}function v(e,t){return[e[0]-t[0],e[1]-t[1]]}function w(e,t){return[e[0]*t,e[1]*t]}function Ae(e,t){return[e[0]/t,e[1]/t]}function q(e){return[e[1],-e[0]]}function Se(e,t){return e[0]*t[0]+e[1]*t[1]}function Ne(e,t){return e[0]===t[0]&&e[1]===t[1]}function Xe(e){return Math.hypot(e[0],e[1])}function Ye(e){return e[0]*e[0]+e[1]*e[1]}function Le(e,t){return Ye(v(e,t))}function Ie(e){return Ae(e,Xe(e))}function ze(e,t){return Math.hypot(e[1]-t[1],e[0]-t[0])}function D(e,t,n){let c=Math.sin(n),l=Math.cos(n),o=e[0]-t[0],d=e[1]-t[1],r=o*l-d*c,f=o*c+d*l;return[r+t[0],f+t[1]]}function ae(e,t,n){return k(e,w(v(t,e),n))}function be(e,t,n){return k(e,w(t,n))}var{min:P,PI:qe}=Math,We=.275,j=qe+1e-4;function De(e,t={}){let{size:n=16,smoothing:c=.5,thinning:l=.5,simulatePressure:o=!0,easing:d=i=>i,start:r={},end:f={},last:C=!1}=t,{cap:A=!0,easing:S=i=>i*(2-i)}=r,{cap:J=!0,easing:g=i=>--i*i*i+1}=f;if(e.length===0||n<=0)return[];let m=e[e.length-1].runningLength,x=r.taper===!1?0:r.taper===!0?Math.max(n,m):r.taper,N=f.taper===!1?0:f.taper===!0?Math.max(n,m):f.taper,ve=Math.pow(n*c,2),X=[],F=[],ee=e.slice(0,10).reduce((i,h)=>{let u=h.pressure;if(o){let a=P(1,h.distance/n),oe=P(1,1-a);u=P(1,i+(oe-i)*(a*We))}return(i+u)/2},e[0].pressure),p=Ee(n,l,e[e.length-1].pressure,d),te,ne=e[0].vector,Y=e[0].point,R=Y,M=Y,B=R,le=!1;for(let i=0;i<e.length;i++){let{pressure:h}=e[i],{point:u,vector:a,distance:oe,runningLength:z}=e[i];if(i<e.length-1&&m-z<3)continue;if(l){if(o){let W=P(1,oe/n),ce=P(1,1-W);h=P(1,ee+(ce-ee)*(W*We))}p=Ee(n,l,h,d)}else p=n/2;te===void 0&&(te=p);let Fe=z<x?S(z/x):1,Pe=m-z<N?g((m-z)/N):1;p=Math.max(.01,p*Math.min(Fe,Pe));let we=(i<e.length-1?e[i+1]:e[i]).vector,ie=i<e.length-1?Se(a,we):1,Oe=Se(a,ne)<0&&!le,ke=ie!==null&&ie<0;if(Oe||ke){let W=w(q(ne),p);for(let ce=1/13,Z=0;Z<=1;Z+=ce)M=D(v(u,W),u,j*Z),X.push(M),B=D(k(u,W),u,j*-Z),F.push(B);Y=M,R=B,ke&&(le=!0);continue}if(le=!1,i===e.length-1){let W=w(q(a),p);X.push(v(u,W)),F.push(k(u,W));continue}let xe=w(q(ae(we,a,ie)),p);M=v(u,xe),(i<=1||Le(Y,M)>ve)&&(X.push(M),Y=M),B=k(u,xe),(i<=1||Le(R,B)>ve)&&(F.push(B),R=B),ee=h,ne=a}let L=e[0].point.slice(0,2),b=e.length>1?e[e.length-1].point.slice(0,2):k(e[0].point,[1,1]),re=[],T=[];if(e.length===1){if(!(x||N)||C){let i=be(L,Ie(q(v(L,b))),-(te||p)),h=[];for(let u=1/13,a=u;a<=1;a+=u)h.push(D(i,L,j*2*a));return h}}else{if(!(x||N&&e.length===1))if(A)for(let h=1/13,u=h;u<=1;u+=h){let a=D(F[0],L,j*u);re.push(a)}else{let h=v(X[0],F[0]),u=w(h,.5),a=w(h,.51);re.push(v(L,u),v(L,a),k(L,a),k(L,u))}let i=q($e(e[e.length-1].vector));if(N||x&&e.length===1)T.push(b);else if(J){let h=be(b,i,p);for(let u=1/29,a=u;a<1;a+=u)T.push(D(h,b,j*3*a))}else T.push(k(b,w(i,p)),k(b,w(i,p*.99)),v(b,w(i,p*.99)),v(b,w(i,p)))}return X.concat(T,F.reverse(),re)}function je(e,t={}){var n;let{streamline:c=.5,size:l=16,last:o=!1}=t;if(e.length===0)return[];let d=.15+(1-c)*.85,r=Array.isArray(e[0])?e:e.map(({x:g,y:m,pressure:x=.5})=>[g,m,x]);if(r.length===2){let g=r[1];r=r.slice(0,-1);for(let m=1;m<5;m++)r.push(ae(r[0],g,m/4))}r.length===1&&(r=[...r,[...k(r[0],[1,1]),...r[0].slice(2)]]);let f=[{point:[r[0][0],r[0][1]],pressure:r[0][2]>=0?r[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],C=!1,A=0,S=f[0],J=r.length-1;for(let g=1;g<r.length;g++){let m=o&&g===J?r[g].slice(0,2):ae(S.point,r[g],d);if(Ne(S.point,m))continue;let x=ze(m,S.point);if(A+=x,g<J&&!C){if(A<l)continue;C=!0}S={point:m,pressure:r[g][2]>=0?r[g][2]:.5,vector:Ie(v(S.point,m)),distance:x,runningLength:A},f.push(S)}return f[0].vector=((n=f[1])==null?void 0:n.vector)||[0,0],f}function He(e,t={}){return De(je(e,t),t)}let O=[];function K(e,t){return(e+t)/2}const he=document.querySelector(".color-picker"),Q=document.getElementById("color-list"),Je=document.querySelectorAll(".color-item"),Re=document.getElementById("color-picker-input"),$=document.getElementById("me"),Te=Ve(20);he.addEventListener("click",e=>{e.stopPropagation(),Q.style.display==="grid"?Q.style.display="none":Q.style.display="grid"});for(let e of Je)e.addEventListener("click",t=>{const n=t.target.style.backgroundColor;he.style.backgroundColor=n,ye(n),Q.style.display="none"});Re.addEventListener("input",e=>{const t="#"+e.target.value;t.length>1&&(he.style.backgroundColor=t,ye(t))});const U=document.getElementById("input-width");U.addEventListener("change",e=>{const t=+U.value;t>+U.max||(s.lineWidth=t,$.style.width=t+"px",$.style.height=t+"px")});const y=document.getElementById("canvas");y.height=document.documentElement.clientHeight;y.width=document.documentElement.clientWidth;const s=y.getContext("2d");s.lineWidth=+U.value;let se=null,ue=null,E=null,I=null;const me=window.location;me.protocol==="https:"?I="wss:":I="ws:";I+="/"+me.host;I+=me.pathname+"/ws";typeof WebSocket<"u"?E=new WebSocket(I):E=new MozWebSocket(I);E.onmessage=function(e){try{const n=e.data.split(":"),c=n[0];if(c==="move"){const l=s.lineWidth,o=s.strokeStyle;y.getContext("2d"),s.beginPath(),s.moveTo(n[1],n[2]),s.lineTo(n[3],n[4]),s.lineWidth=n[5],s.strokeStyle=n[6],s.stroke(),s.strokeStyle=o,s.lineWidth=l}if(c==="clear"&&(O=[],s.clearRect(0,0,y.width,y.height)),c==="cur"){const l=n[1];let o;if(o=document.getElementById(l),o===null){o=document.createElement("div"),o.id=l,o.className="trailer",document.body.appendChild(o);return}const d={transform:`translate(${n[2]}px, ${n[3]}px)`};o.animate(d,{fill:"forwards"})}if(c==="disconnect"){let l=document.getElementsByClassName("trailer");if(l.length===0)return;for(var t=0;t<l.length;t++)l[t].id!=="me"&&(document.body.removeChild(l[t]),t--)}if(n[0]==="line"){let l={lines:JSON.parse(n[3]),color:n[1],strokeWidth:n[2]};O.push(l),pe(JSON.parse(n[3]),n[1],n[2])}}catch(n){console.log(n)}};E.onclose=function(e){console.log("lost connection"),typeof WebSocket<"u"?E=new WebSocket(I):E=new MozWebSocket(I)};let ge=!1,V=!1,de=document.querySelectorAll(".clr");de=Array.from(de);de.forEach(e=>{e.addEventListener("click",()=>{ye(e.dataset.clr)})});let Ze=document.getElementById("clear-btn");Ze.addEventListener("click",()=>{O=[],s.clearRect(0,0,y.width,y.height),E.send("clear:")});let Ke=document.getElementById("save-btn");Ke.addEventListener("click",()=>{let e=y.toDataURL("imag/png"),t=document.createElement("a");t.href=e,t.download="sketch.png",t.click()});let G=0,_=0,Ce,Me,Qe=1,fe=0,H=[];window.addEventListener("mousedown",e=>{if(e.which===2){V=!0,Ce=e.clientX-G,Me=e.clientY-_;return}fe=0,H=[],e.button===0&&e.target.id==="canvas"&&(ge=!0)});window.addEventListener("mouseup",e=>{if(V){V=!1;return}ge=!1;let t={lines:H,color:s.fillStyle,strokeWidth:s.lineWidth};O.push(t),E.send("line:"+s.strokeStyle+":"+s.lineWidth+":"+JSON.stringify(H)+":")});window.addEventListener("mousemove",e=>{if(V){G=e.clientX-Ce,_=e.clientY-Me,y.width+=1,y.width-=1,Be();return}if(e.button!==0)return;const t=e.clientX-$.offsetWidth/2,n=e.clientY-$.offsetHeight/2;if(Ue(t,n),E.send("cur:"+Te+":"+t+":"+n+":"),se==null||ue==null||!ge){se=e.clientX,ue=e.clientY;return}let c=e.clientX,l=e.clientY;fe++,fe%Qe===0&&(H.push([c-G,l-_]),pe(H,s.fillStyle,s.lineWidth)),se=c,ue=l});window.addEventListener("resize",e=>{y.height=document.documentElement.clientHeight,y.width=document.documentElement.clientWidth,Be()});function Be(){for(let e=0;e<O.length;e++){const t=O[e];pe(t.lines,t.color,t.strokeWidth)}}function pe(e,t,n){let c=[];for(let f=0;f<e.length;f++){let C=e[f];c.push([C[0]+G,C[1]+_])}const l=He(c,{size:n,thinning:.7}),o=Ge(l),d=new Path2D(o);let r=s.fillStyle;s.fillStyle=t,s.fill(d),s.fillStyle=r}function Ue(e,t){const n={transform:`translate(${e}px, ${t}px)`};$.animate(n,{fill:"forwards"})}function Ve(e){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",c=n.length;for(let l=0;l<e;l++)t+=n.charAt(Math.floor(Math.random()*c));return t}function ye(e){s.fillStyle=e,s.strokeStyle=e,$.style.backgroundColor=e;const t=document.querySelectorAll(".trailer");for(let n of t)n.style.backgroundColor=e}rough.canvas(document.getElementById("canvas"));function Ge(e,t=!0){const n=e.length;if(n<4)return"";let c=e[0],l=e[1];const o=e[2];let d=`M${c[0].toFixed(2)},${c[1].toFixed(2)} Q${l[0].toFixed(2)},${l[1].toFixed(2)} ${K(l[0],o[0]).toFixed(2)},${K(l[1],o[1]).toFixed(2)} T`;for(let r=2,f=n-1;r<f;r++)c=e[r],l=e[r+1],d+=`${K(c[0],l[0]).toFixed(2)},${K(c[1],l[1]).toFixed(2)} `;return t&&(d+="Z"),d}
